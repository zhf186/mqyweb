# è‡ªåŠ¨éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨

## ğŸš€ ä¸€é”®éƒ¨ç½²

### ä½¿ç”¨æ–¹æ³•

1. **ç¡®ä¿å·²æ¨é€ä»£ç åˆ° GitHub**
   ```powershell
   # åœ¨ D:\mrcweb1 ç›®å½•
   git push origin main
   ```

2. **è¿è¡Œè‡ªåŠ¨éƒ¨ç½²è„šæœ¬**
   ```powershell
   # åŒå‡»è¿è¡Œ
   deploy-to-server.bat
   
   # æˆ–åœ¨ PowerShell ä¸­è¿è¡Œ
   .\deploy-to-server.bat
   ```

3. **æŒ‰ç…§æç¤ºæ“ä½œ**
   - è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼ˆä¼šæç¤º 2-3 æ¬¡ï¼‰
   - å¦‚æœæ˜¯é¦–æ¬¡éƒ¨ç½²ï¼Œéœ€è¦é…ç½® GitHub SSH å¯†é’¥ï¼ˆè„šæœ¬ä¼šæ˜¾ç¤ºå…¬é’¥ï¼‰
   - ç­‰å¾…éƒ¨ç½²å®Œæˆï¼ˆçº¦ 15-20 åˆ†é’Ÿï¼‰

---

## ğŸ“‹ è„šæœ¬åŠŸèƒ½

è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

### 1. ç¯å¢ƒæ£€æŸ¥
- âœ“ æ£€æŸ¥ Docker
- âœ“ æ£€æŸ¥ Docker Compose
- âœ“ æ£€æŸ¥ Git
- âœ“ æ£€æŸ¥ Nginx

### 2. SSH å¯†é’¥é…ç½®
- âœ“ ç”Ÿæˆ SSH å¯†é’¥ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
- âœ“ æ˜¾ç¤ºå…¬é’¥ä¾›æ·»åŠ åˆ° GitHub
- âœ“ æµ‹è¯• GitHub è¿æ¥

### 3. ä»£ç éƒ¨ç½²
- âœ“ åˆ›å»ºé¡¹ç›®ç›®å½•
- âœ“ å…‹éš†æˆ–æ›´æ–°ä»£ç 
- âœ“ é…ç½®ç¯å¢ƒå˜é‡

### 4. Docker éƒ¨ç½²
- âœ“ æ„å»º Docker é•œåƒ
- âœ“ å¯åŠ¨æ‰€æœ‰å®¹å™¨
- âœ“ éªŒè¯æœåŠ¡çŠ¶æ€

### 5. Nginx é…ç½®
- âœ“ å¤åˆ¶ Nginx é…ç½®
- âœ“ æµ‹è¯•é…ç½®
- âœ“ é‡è½½ Nginx

### 6. SSL é…ç½®
- âœ“ æ£€æŸ¥ç°æœ‰è¯ä¹¦
- âœ“ é…ç½®æ–°è¯ä¹¦ï¼ˆå¦‚æœéœ€è¦ï¼‰

### 7. éªŒè¯éƒ¨ç½²
- âœ“ æ£€æŸ¥å®¹å™¨çŠ¶æ€
- âœ“ æµ‹è¯• HTTPS è®¿é—®
- âœ“ æ˜¾ç¤ºè®¿é—®åœ°å€

---

## âš ï¸ é¦–æ¬¡éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 1. GitHub SSH å¯†é’¥é…ç½®

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œè„šæœ¬ä¼šç”Ÿæˆ SSH å¯†é’¥å¹¶æ˜¾ç¤ºå…¬é’¥ï¼š

```
==========================================
é‡è¦: è¯·å°†ä»¥ä¸‹å…¬é’¥æ·»åŠ åˆ° GitHub
è®¿é—®: https://github.com/settings/keys
==========================================
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAA... deploy@manqiyou.cn
==========================================

æ·»åŠ å®ŒæˆåæŒ‰ Enter ç»§ç»­...
```

**æ“ä½œæ­¥éª¤**ï¼š
1. å¤åˆ¶æ˜¾ç¤ºçš„å…¬é’¥
2. è®¿é—® https://github.com/settings/keys
3. ç‚¹å‡» "New SSH key"
4. Title: "é˜¿é‡Œäº‘æœåŠ¡å™¨"
5. Key: ç²˜è´´å…¬é’¥
6. ç‚¹å‡» "Add SSH key"
7. è¿”å›ç»ˆç«¯ï¼ŒæŒ‰ Enter ç»§ç»­

### 2. SSL è¯ä¹¦é…ç½®

é¦–æ¬¡é…ç½® SSL æ—¶ï¼Œéœ€è¦ï¼š
1. ç¡®è®¤é‚®ç®±åœ°å€
2. åŒæ„æœåŠ¡æ¡æ¬¾
3. ç­‰å¾…è¯ä¹¦è·å–å®Œæˆ

è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†è¿™äº›æ­¥éª¤ã€‚

---

## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²ï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰

å¦‚æœè‡ªåŠ¨è„šæœ¬é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œï¼š

### 1. è¿æ¥æœåŠ¡å™¨
```powershell
ssh root@47.97.21.33
```

### 2. æ‰§è¡Œéƒ¨ç½²å‘½ä»¤
```bash
# é…ç½® SSH å¯†é’¥
ssh-keygen -t ed25519 -C "deploy@manqiyou.cn"
cat ~/.ssh/id_ed25519.pub
# æ·»åŠ åˆ° GitHub: https://github.com/settings/keys

# å…‹éš†ä»£ç 
sudo mkdir -p /var/www/manqiyou
sudo chown -R $USER:$USER /var/www/manqiyou
cd /var/www/manqiyou
git clone git@github.com:zhf186/mqyweb.git .

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.production .env

# éƒ¨ç½²
chmod +x deploy/quick-deploy.sh
bash deploy/quick-deploy.sh

# é…ç½® Nginx
sudo cp deploy/nginx-manqiyou.conf /etc/nginx/sites-available/manqiyou
sudo ln -s /etc/nginx/sites-available/manqiyou /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx

# é…ç½® SSL
sudo chmod +x deploy/setup-ssl.sh
sudo bash deploy/setup-ssl.sh
```

---

## ğŸ“Š éƒ¨ç½²æ—¶é—´ä¼°ç®—

| æ­¥éª¤ | é¢„è®¡æ—¶é—´ |
|------|---------|
| ç¯å¢ƒæ£€æŸ¥ | 10 ç§’ |
| SSH å¯†é’¥é…ç½® | 30 ç§’ |
| ä»£ç å…‹éš† | 1-2 åˆ†é’Ÿ |
| Docker æ„å»º | 10-15 åˆ†é’Ÿ |
| Nginx é…ç½® | 30 ç§’ |
| SSL é…ç½® | 1-2 åˆ†é’Ÿ |
| éªŒè¯éƒ¨ç½² | 30 ç§’ |
| **æ€»è®¡** | **15-20 åˆ†é’Ÿ** |

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å¿—

éƒ¨ç½²æˆåŠŸåï¼Œæ‚¨ä¼šçœ‹åˆ°ï¼š

```
==========================================
éƒ¨ç½²å®Œæˆï¼
==========================================

è®¿é—®åœ°å€: https://www.manqiyou.cn

å¸¸ç”¨å‘½ä»¤:
  æŸ¥çœ‹æ—¥å¿—: cd /var/www/manqiyou && docker-compose -f docker-compose.prod.yml logs -f
  é‡å¯æœåŠ¡: cd /var/www/manqiyou && docker-compose -f docker-compose.prod.yml restart
  åœæ­¢æœåŠ¡: cd /var/www/manqiyou && docker-compose -f docker-compose.prod.yml down
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: SSH è¿æ¥å¤±è´¥

**é”™è¯¯**: `Connection refused` æˆ– `Permission denied`

**è§£å†³**:
```powershell
# æµ‹è¯• SSH è¿æ¥
ssh root@47.97.21.33

# å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ï¼š
# 1. æœåŠ¡å™¨ IP æ˜¯å¦æ­£ç¡®
# 2. æœåŠ¡å™¨æ˜¯å¦å¼€å¯ SSH æœåŠ¡
# 3. é˜²ç«å¢™æ˜¯å¦å…è®¸ SSH è¿æ¥
```

### é—®é¢˜ 2: GitHub å…‹éš†å¤±è´¥

**é”™è¯¯**: `Permission denied (publickey)`

**è§£å†³**:
1. ç¡®ä¿å·²å°†æœåŠ¡å™¨çš„ SSH å…¬é’¥æ·»åŠ åˆ° GitHub
2. æµ‹è¯•è¿æ¥: `ssh -T git@github.com`
3. å¦‚æœå¤±è´¥ï¼Œé‡æ–°ç”Ÿæˆå¯†é’¥å¹¶æ·»åŠ åˆ° GitHub

### é—®é¢˜ 3: Docker æ„å»ºå¤±è´¥

**é”™è¯¯**: `docker: command not found` æˆ–æ„å»ºé”™è¯¯

**è§£å†³**:
```bash
# æ£€æŸ¥ Docker çŠ¶æ€
sudo systemctl status docker

# é‡å¯ Docker
sudo systemctl restart docker

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs
```

### é—®é¢˜ 4: Nginx é…ç½®é”™è¯¯

**é”™è¯¯**: `nginx: configuration file test failed`

**è§£å†³**:
```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log

# æ£€æŸ¥é…ç½®æ–‡ä»¶
sudo nano /etc/nginx/sites-available/manqiyou
```

### é—®é¢˜ 5: SSL è¯ä¹¦è·å–å¤±è´¥

**é”™è¯¯**: `Failed to obtain certificate`

**è§£å†³**:
1. ç¡®ä¿åŸŸåå·²æ­£ç¡®è§£æåˆ°æœåŠ¡å™¨ IP
2. æ£€æŸ¥é˜²ç«å¢™æ˜¯å¦å¼€æ”¾ 80 å’Œ 443 ç«¯å£
3. æŸ¥çœ‹ Certbot æ—¥å¿—: `sudo certbot certificates`

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

ä»£ç æ›´æ–°åï¼Œé‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼š

```powershell
# 1. æ¨é€æ–°ä»£ç 
cd D:\mrcweb1
git add .
git commit -m "æ›´æ–°è¯´æ˜"
git push origin main

# 2. é‡æ–°éƒ¨ç½²
.\deploy-to-server.bat
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
- æ‹‰å–æœ€æ–°ä»£ç 
- é‡æ–°æ„å»ºé•œåƒ
- é‡å¯å®¹å™¨

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ—¥å¿—**
   ```bash
   cd /var/www/manqiyou
   docker-compose -f docker-compose.prod.yml logs -f
   ```

2. **æ£€æŸ¥å®¹å™¨çŠ¶æ€**
   ```bash
   docker-compose -f docker-compose.prod.yml ps
   ```

3. **æŸ¥çœ‹ Nginx æ—¥å¿—**
   ```bash
   sudo tail -f /var/log/nginx/manqiyou_error.log
   ```

4. **å‚è€ƒè¯¦ç»†æ–‡æ¡£**
   - `deploy/é˜¿é‡Œäº‘éƒ¨ç½²å®Œæ•´æ–¹æ¡ˆ.md`
   - `å®Œæ•´éƒ¨ç½²æµç¨‹.md`

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

```powershell
# 1. ç¡®ä¿ä»£ç å·²æ¨é€
cd D:\mrcweb1
git push origin main

# 2. è¿è¡Œè‡ªåŠ¨éƒ¨ç½²
.\deploy-to-server.bat

# 3. ç­‰å¾…å®Œæˆï¼ˆ15-20 åˆ†é’Ÿï¼‰

# 4. è®¿é—®ç½‘ç«™
# https://www.manqiyou.cn
```

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-29  
**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 15-20 åˆ†é’Ÿ
