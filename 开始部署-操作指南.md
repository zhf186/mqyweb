# æ¼«éª‘æ¸¸é¡¹ç›® - ç«‹å³å¼€å§‹éƒ¨ç½²

## ğŸ“‹ å½“å‰çŠ¶æ€

âœ… æ‰€æœ‰éƒ¨ç½²æ–‡ä»¶å·²åˆ›å»ºå®Œæˆ
âœ… é¡¹ç›®ä»£ç å·²å‡†å¤‡å°±ç»ª
â³ å‡†å¤‡æ¨é€åˆ° GitHub å¹¶éƒ¨ç½²åˆ°æœåŠ¡å™¨

---

## ğŸ¯ éƒ¨ç½²æ­¥éª¤ï¼ˆè¯·æŒ‰é¡ºåºæ‰§è¡Œï¼‰

### æ­¥éª¤ 1ï¼šæäº¤ä»£ç åˆ° GitHub

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ Git GUI å·¥å…·ï¼ˆæ¨èï¼‰

å¦‚æœæ‚¨ä½¿ç”¨ GitHub Desktop æˆ–å…¶ä»– Git GUI å·¥å…·ï¼š

1. æ‰“å¼€ Git å®¢æˆ·ç«¯
2. æŸ¥çœ‹æ‰€æœ‰æ–°å¢å’Œä¿®æ”¹çš„æ–‡ä»¶
3. æäº¤æ¶ˆæ¯ï¼š`å‡†å¤‡éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ - æ·»åŠ å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ`
4. æ¨é€åˆ° GitHub ä»“åº“ `git@github.com:zhf186/mqyweb.git`

#### æ–¹å¼äºŒï¼šä½¿ç”¨å‘½ä»¤è¡Œï¼ˆå¦‚æœå·²å®‰è£… Gitï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
git add .
git commit -m "å‡†å¤‡éƒ¨ç½²åˆ°é˜¿é‡Œäº‘ - æ·»åŠ å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ"
git push origin main
```

**æ–°å¢çš„æ–‡ä»¶æ¸…å•**ï¼š
- docker-compose.prod.yml
- .env.production
- backend/manqiyou-app/Dockerfile
- frontend/Dockerfile
- deploy/nginx-manqiyou.conf
- deploy/quick-deploy.sh
- deploy/setup-ssl.sh
- deploy/deploy-to-aliyun.sh
- deploy/é˜¿é‡Œäº‘éƒ¨ç½²å®Œæ•´æ–¹æ¡ˆ.md
- deploy/README-ALIYUN.md
- deploy/DEPLOYMENT_CHECKLIST.md
- deploy/éƒ¨ç½²æ–‡ä»¶è¯´æ˜.md
- PROJECT_SUMMARY.md
- DEPLOYMENT_READY.md
- å¼€å§‹éƒ¨ç½²-æ“ä½œæŒ‡å—.mdï¼ˆæœ¬æ–‡ä»¶ï¼‰

---

### æ­¥éª¤ 2ï¼šè¿æ¥åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨

ä½¿ç”¨ SSH å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡å™¨ï¼š

**æœåŠ¡å™¨ä¿¡æ¯**ï¼š
- IP: 47.37.21.33
- ç”¨æˆ·: rootï¼ˆæˆ–æ‚¨çš„ç”¨æˆ·åï¼‰
- ç«¯å£: 22

#### Windows ç”¨æˆ·

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ PowerShell**
```powershell
ssh root@47.37.21.33
```

**æ–¹å¼äºŒï¼šä½¿ç”¨ PuTTY**
1. æ‰“å¼€ PuTTY
2. Host Name: 47.37.21.33
3. Port: 22
4. ç‚¹å‡» Open
5. è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 

**æ–¹å¼ä¸‰ï¼šä½¿ç”¨ Windows Terminal**
```bash
ssh root@47.37.21.33
```

---

### æ­¥éª¤ 3ï¼šåœ¨æœåŠ¡å™¨ä¸Šé…ç½® Git SSH å¯†é’¥

è¿æ¥åˆ°æœåŠ¡å™¨åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
# 1. ç”Ÿæˆ SSH å¯†é’¥ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
ssh-keygen -t ed25519 -C "your-email@example.com"
# æŒ‰ Enter ä½¿ç”¨é»˜è®¤è·¯å¾„
# æŒ‰ Enter è·³è¿‡å¯†ç ï¼ˆæˆ–è®¾ç½®å¯†ç ï¼‰

# 2. æŸ¥çœ‹å…¬é’¥
cat ~/.ssh/id_ed25519.pub

# 3. å¤åˆ¶æ˜¾ç¤ºçš„å…¬é’¥å†…å®¹
```

**ç„¶ååœ¨ GitHub ä¸Šæ·»åŠ  SSH å¯†é’¥**ï¼š
1. è®¿é—® https://github.com/settings/keys
2. ç‚¹å‡» "New SSH key"
3. Title: "é˜¿é‡Œäº‘æœåŠ¡å™¨"
4. Key: ç²˜è´´åˆšæ‰å¤åˆ¶çš„å…¬é’¥
5. ç‚¹å‡» "Add SSH key"

**æµ‹è¯•è¿æ¥**ï¼š
```bash
ssh -T git@github.com
# åº”è¯¥çœ‹åˆ°ï¼šHi zhf186! You've successfully authenticated...
```

---

### æ­¥éª¤ 4ï¼šå…‹éš†é¡¹ç›®ä»£ç 

```bash
# 1. åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/manqiyou
sudo chown -R $USER:$USER /var/www/manqiyou

# 2. å…‹éš†ä»£ç 
cd /var/www/manqiyou
git clone git@github.com:zhf186/mqyweb.git .

# 3. ç¡®è®¤æ–‡ä»¶å·²ä¸‹è½½
ls -la
```

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥çœ‹åˆ°é¡¹ç›®çš„æ‰€æœ‰æ–‡ä»¶å’Œæ–‡ä»¶å¤¹

---

### æ­¥éª¤ 5ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
cd /var/www/manqiyou

# 1. å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.production .env

# 2. ç¼–è¾‘ç¯å¢ƒå˜é‡
nano .env
```

**ä¿®æ”¹ä»¥ä¸‹å†…å®¹**ï¼ˆä½¿ç”¨å¼ºå¯†ç ï¼‰ï¼š

```bash
# æ•°æ®åº“å¯†ç ï¼ˆè¯·ä½¿ç”¨å¼ºå¯†ç ï¼Œè‡³å°‘ 16 ä½ï¼‰
DB_PASSWORD=Manqiyou2024!@#$%^&*()

# Redis å¯†ç ï¼ˆè¯·ä½¿ç”¨å¼ºå¯†ç ï¼‰
REDIS_PASSWORD=Redis2024!@#$%^&*()

# JWT å¯†é’¥ï¼ˆä½¿ç”¨éšæœºå­—ç¬¦ä¸²ï¼‰
JWT_SECRET=your_jwt_secret_change_this_to_random_string_32_chars

# API URLï¼ˆå·²é…ç½®å¥½ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
NEXT_PUBLIC_API_URL=https://www.manqiyou.cn/api
```

**ä¿å­˜å¹¶é€€å‡º**ï¼š
- æŒ‰ `Ctrl + X`
- æŒ‰ `Y` ç¡®è®¤
- æŒ‰ `Enter` ä¿å­˜

---

### æ­¥éª¤ 6ï¼šè¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
cd /var/www/manqiyou

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x deploy/quick-deploy.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy/quick-deploy.sh
```

**è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨**ï¼š
1. æ£€æŸ¥ç¯å¢ƒä¾èµ–
2. åœæ­¢æ—§å®¹å™¨ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
3. æ„å»º Docker é•œåƒï¼ˆéœ€è¦ 10-15 åˆ†é’Ÿï¼‰
4. å¯åŠ¨æ‰€æœ‰å®¹å™¨
5. éªŒè¯æœåŠ¡çŠ¶æ€

**ç­‰å¾…æ„å»ºå®Œæˆ**ï¼Œæ‚¨ä¼šçœ‹åˆ°ç±»ä¼¼çš„è¾“å‡ºï¼š
```
âœ“ ç¯å¢ƒæ£€æŸ¥é€šè¿‡
âœ“ é¡¹ç›®ç›®å½•å·²åˆ›å»º
âœ“ ä»£ç å·²æ›´æ–°
âœ“ ç¯å¢ƒå˜é‡é…ç½®å·²å°±ç»ª
âœ“ æ—§å®¹å™¨å·²åœæ­¢
âœ“ Docker å®¹å™¨å·²å¯åŠ¨
âœ“ æœåŠ¡å¯åŠ¨ç­‰å¾…å®Œæˆ
âœ“ æœåŠ¡çŠ¶æ€æ£€æŸ¥å®Œæˆ
```

---

### æ­¥éª¤ 7ï¼šé…ç½® Nginx åå‘ä»£ç†

```bash
# 1. å¤åˆ¶ Nginx é…ç½®æ–‡ä»¶
sudo cp /var/www/manqiyou/deploy/nginx-manqiyou.conf /etc/nginx/sites-available/manqiyou

# 2. åˆ›å»ºè½¯é“¾æ¥å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/manqiyou /etc/nginx/sites-enabled/

# 3. æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# 4. å¦‚æœæµ‹è¯•é€šè¿‡ï¼Œé‡è½½ Nginx
sudo systemctl reload nginx

# 5. æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx
```

**é¢„æœŸç»“æœ**ï¼š
- `nginx -t` æ˜¾ç¤º "syntax is ok" å’Œ "test is successful"
- Nginx æœåŠ¡çŠ¶æ€ä¸º "active (running)"

---

### æ­¥éª¤ 8ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆHTTPSï¼‰

```bash
# 1. ç¼–è¾‘ SSL é…ç½®è„šæœ¬ï¼Œä¿®æ”¹é‚®ç®±åœ°å€
sudo nano /var/www/manqiyou/deploy/setup-ssl.sh

# æ‰¾åˆ°è¿™ä¸€è¡Œï¼š
# EMAIL="your-email@example.com"
# æ”¹ä¸ºä½ çš„å®é™…é‚®ç®±ï¼Œä¾‹å¦‚ï¼š
# EMAIL="admin@manqiyou.cn"

# ä¿å­˜å¹¶é€€å‡ºï¼ˆCtrl+X, Y, Enterï¼‰

# 2. æ·»åŠ æ‰§è¡Œæƒé™
sudo chmod +x /var/www/manqiyou/deploy/setup-ssl.sh

# 3. è¿è¡Œ SSL é…ç½®è„šæœ¬
sudo bash /var/www/manqiyou/deploy/setup-ssl.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨**ï¼š
1. å®‰è£… Certbot
2. è·å– Let's Encrypt SSL è¯ä¹¦
3. é…ç½®è‡ªåŠ¨ç»­æœŸ
4. æµ‹è¯•ç»­æœŸåŠŸèƒ½

**æŒ‰ç…§æç¤ºæ“ä½œ**ï¼š
- ç¡®è®¤é‚®ç®±åœ°å€
- åŒæ„æœåŠ¡æ¡æ¬¾
- ç­‰å¾…è¯ä¹¦è·å–å®Œæˆ

---

### æ­¥éª¤ 9ï¼šéªŒè¯éƒ¨ç½²

#### 9.1 æµ‹è¯• HTTPS è®¿é—®

```bash
# æµ‹è¯• HTTPS
curl -I https://www.manqiyou.cn

# åº”è¯¥è¿”å› 200 OK
```

#### 9.2 åœ¨æµè§ˆå™¨ä¸­è®¿é—®

æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š
- https://www.manqiyou.cn

**æ£€æŸ¥é¡¹**ï¼š
- [ ] é¡µé¢æ­£å¸¸åŠ è½½
- [ ] æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨é”å›¾æ ‡
- [ ] å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- [ ] æ‰€æœ‰é¡µé¢å¯è®¿é—®
- [ ] ä¸­è‹±æ–‡åˆ‡æ¢æ­£å¸¸

#### 9.3 æµ‹è¯• API

```bash
# æµ‹è¯•åç«¯ API
curl https://www.manqiyou.cn/api/health

# åº”è¯¥è¿”å› {"status":"ok"} æˆ–ç±»ä¼¼å†…å®¹
```

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

ä½¿ç”¨ `deploy/DEPLOYMENT_CHECKLIST.md` è¿›è¡Œå®Œæ•´æ£€æŸ¥ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹æ£€æŸ¥æ¸…å•
cat /var/www/manqiyou/deploy/DEPLOYMENT_CHECKLIST.md
```

### æ ¸å¿ƒæ£€æŸ¥é¡¹

- [ ] æ‰€æœ‰ Docker å®¹å™¨éƒ½åœ¨è¿è¡Œ
- [ ] ç½‘ç«™å¯é€šè¿‡ HTTPS è®¿é—®
- [ ] HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS
- [ ] SSL è¯ä¹¦æœ‰æ•ˆ
- [ ] æ‰€æœ‰é¡µé¢æ­£å¸¸åŠ è½½
- [ ] API æ¥å£æ­£å¸¸å·¥ä½œ
- [ ] å›¾ç‰‡å’Œé™æ€èµ„æºæ­£å¸¸æ˜¾ç¤º
- [ ] è‡ªåŠ¨ç»­æœŸå·²é…ç½®

---

## ğŸ”§ å¸¸ç”¨ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
cd /var/www/manqiyou

# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f frontend
docker-compose -f docker-compose.prod.yml logs -f backend
```

### é‡å¯æœåŠ¡

```bash
cd /var/www/manqiyou

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f docker-compose.prod.yml restart frontend
docker-compose -f docker-compose.prod.yml restart backend
```

### æ›´æ–°ä»£ç 

```bash
cd /var/www/manqiyou

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose -f docker-compose.prod.yml up -d --build
```

### æŸ¥çœ‹ Nginx æ—¥å¿—

```bash
# è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/manqiyou_access.log

# é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/manqiyou_error.log
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå®¹å™¨æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tulpn | grep -E ':(3000|8080|5432|6379)'

# é‡å¯ Docker
sudo systemctl restart docker
```

### é—®é¢˜ 2ï¼šNginx 502 é”™è¯¯

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
curl http://localhost:8080/api/health

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/manqiyou_error.log

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps
```

### é—®é¢˜ 3ï¼šSSL è¯ä¹¦è·å–å¤±è´¥

```bash
# æ£€æŸ¥åŸŸåè§£æ
nslookup www.manqiyou.cn

# æ£€æŸ¥ 80 ç«¯å£æ˜¯å¦å¯è®¿é—®
curl http://www.manqiyou.cn

# æŸ¥çœ‹ Certbot æ—¥å¿—
sudo journalctl -u certbot -n 50
```

---

## ğŸ“ è·å–å¸®åŠ©

### è¯¦ç»†æ–‡æ¡£

- **å®Œæ•´éƒ¨ç½²æŒ‡å—**: `deploy/é˜¿é‡Œäº‘éƒ¨ç½²å®Œæ•´æ–¹æ¡ˆ.md`
- **æ£€æŸ¥æ¸…å•**: `deploy/DEPLOYMENT_CHECKLIST.md`
- **å¿«é€Ÿå‚è€ƒ**: `deploy/README-ALIYUN.md`

### æŸ¥çœ‹æ—¥å¿—

```bash
# Docker å®¹å™¨æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/manqiyou_error.log

# ç³»ç»Ÿæ—¥å¿—
sudo journalctl -xe
```

---

## ğŸ‰ éƒ¨ç½²æˆåŠŸï¼

å½“æ‰€æœ‰æ£€æŸ¥é¡¹éƒ½é€šè¿‡åï¼Œæ‚¨çš„ç½‘ç«™å°±æˆåŠŸéƒ¨ç½²äº†ï¼

**è®¿é—®åœ°å€**: https://www.manqiyou.cn

**æ­å–œï¼æ¼«éª‘æ¸¸é¡¹ç›®å·²æˆåŠŸéƒ¨ç½²åˆ°é˜¿é‡Œäº‘ï¼** ğŸš€

---

**æ“ä½œæŒ‡å—ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-01-29
