# 当前部署状态

**更新时间**: 2026-01-30 10:15 (UTC+8)  
**状态**: ✅ 所有系统正常运行

## 系统状态

### 前端 (Frontend)
- **URL**: https://www.manqiyou.cn
- **状态**: ✅ 正常运行
- **容器**: manqiyou-frontend
- **端口**: 127.0.0.1:3001 → 3000

### 后端 (Backend)
- **API URL**: https://www.manqiyou.cn/api
- **状态**: ✅ 正常运行
- **容器**: manqiyou-backend
- **端口**: 127.0.0.1:8081 → 8080
- **数据库**: H2 内存数据库
- **启动时间**: 2026-01-30 02:13:19 UTC

### 数据库 (PostgreSQL)
- **状态**: ✅ 正常运行
- **容器**: manqiyou-postgres
- **端口**: 127.0.0.1:5432

### 缓存 (Redis)
- **状态**: ✅ 正常运行
- **容器**: manqiyou-redis
- **端口**: 127.0.0.1:6379

### Web 服务器 (Nginx)
- **状态**: ✅ 正常运行
- **版本**: nginx/1.24.0 (Ubuntu)
- **SSL**: ✅ Let's Encrypt 证书有效

## 最近修复

### 2026-01-30: CORS 重复头问题 ✅
- **问题**: API 请求失败，CORS 头显示 `'https://manqiyou.cn, *'`
- **原因**: CORS 配置重复导致头部值重复
- **解决**: 
  - 更新 CorsConfig.java 添加 @Order(HIGHEST_PRECEDENCE)
  - 从 application.yml 移除 CORS 配置
  - 重新构建并部署后端容器
- **验证**: ✅ CORS 头正确，API 正常返回数据

### 2026-01-30: Routes 页面图片优化 ✅
- **修改**: 移除 emoji 图标，添加品牌图片到特色卡片
- **状态**: ✅ 已部署

## API 测试结果

```bash
# 测试 API 端点
$ curl -s https://www.manqiyou.cn/api/routes | jq '.code, .message, (.data.records | length)'
200
"success"
6

# 测试 CORS 头
$ curl -I -H 'Origin: https://www.manqiyou.cn' https://www.manqiyou.cn/api/routes
HTTP/2 200
access-control-allow-origin: https://www.manqiyou.cn  ✅
access-control-allow-credentials: true
```

## 页面功能状态

| 页面 | URL | 状态 | 备注 |
|------|-----|------|------|
| 首页 | / | ✅ | 正常 |
| 骑行线路 | /routes | ✅ | API 数据加载正常 |
| 关于我们 | /about | ✅ | 正常 |
| E-BIKE | /ebike | ✅ | 正常 |
| 社区 | /community | ✅ | 正常 |
| 商城 | /goods | ✅ | 正常 |
| 合作伙伴 | /partners | ✅ | 正常 |

## 服务器信息

- **IP**: 47.97.21.33
- **系统**: Ubuntu 24.04
- **项目目录**: /opt/mqyweb
- **域名**: 
  - www.manqiyou.cn (主域名)
  - manqiyou.cn (重定向到 www)

## Docker 容器状态

```bash
$ docker-compose -f docker-compose.prod.yml ps
NAME                  STATUS    PORTS
manqiyou-backend      Up        127.0.0.1:8081->8080/tcp
manqiyou-frontend     Up        127.0.0.1:3001->3000/tcp
manqiyou-postgres     Up        127.0.0.1:5432->5432/tcp
manqiyou-redis        Up        127.0.0.1:6379->6379/tcp
```

## 常用命令

### 查看日志
```bash
cd /opt/mqyweb
docker-compose -f docker-compose.prod.yml logs -f backend
docker-compose -f docker-compose.prod.yml logs -f frontend
```

### 重启服务
```bash
cd /opt/mqyweb
docker-compose -f docker-compose.prod.yml restart backend
docker-compose -f docker-compose.prod.yml restart frontend
```

### 更新代码
```bash
cd /opt/mqyweb
git pull
docker-compose -f docker-compose.prod.yml build --no-cache backend
docker-compose -f docker-compose.prod.yml up -d backend
```

### 检查 Nginx
```bash
sudo nginx -t
sudo systemctl status nginx
sudo systemctl reload nginx
```

## 监控建议

1. **定期检查日志**: 每天查看容器日志，确保没有错误
2. **监控磁盘空间**: Docker 镜像和日志会占用空间
3. **SSL 证书续期**: Let's Encrypt 证书每 90 天需要续期
4. **备份数据库**: 定期备份 PostgreSQL 数据（如果使用）
5. **性能监控**: 监控 API 响应时间和服务器负载

## 下一步计划

- [ ] 配置自动化部署脚本
- [ ] 设置日志轮转
- [ ] 配置监控告警
- [ ] 优化前端性能（图片压缩、CDN）
- [ ] 添加 API 速率限制
