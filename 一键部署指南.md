# ä¸€é”®éƒ¨ç½²æŒ‡å—

## ğŸš€ æœ€ç®€å•çš„éƒ¨ç½²æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨æœ¬åœ° BAT è„šæœ¬ï¼ˆæ¨èï¼‰

1. **ç¡®ä¿ä»£ç å·²æ¨é€**
   ```powershell
   cd D:\mrcweb1
   git push origin main
   ```

2. **è¿è¡Œéƒ¨ç½²è„šæœ¬**
   ```powershell
   .\deploy-to-server.bat
   ```

3. **æŒ‰ç…§æç¤ºæ“ä½œ**
   - è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼ˆ2-3æ¬¡ï¼‰
   - é¦–æ¬¡éƒ¨ç½²éœ€è¦é…ç½® GitHub SSH å¯†é’¥
   - ç­‰å¾…å®Œæˆï¼ˆ15-20åˆ†é’Ÿï¼‰

---

### æ–¹æ³•äºŒï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆæ›´ç®€å•ï¼‰

å¦‚æœæ–¹æ³•ä¸€é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

#### æ­¥éª¤ 1ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

```powershell
ssh root@47.97.21.33
```

#### æ­¥éª¤ 2ï¼šä¸‹è½½å¹¶æ‰§è¡Œéƒ¨ç½²è„šæœ¬

```bash
# ä¸‹è½½éƒ¨ç½²è„šæœ¬
curl -o server-deploy.sh https://raw.githubusercontent.com/zhf186/mqyweb/main/deploy/server-deploy.sh

# æˆ–è€…å¦‚æœä¸Šé¢çš„å‘½ä»¤å¤±è´¥ï¼Œä½¿ç”¨ wget
wget https://raw.githubusercontent.com/zhf186/mqyweb/main/deploy/server-deploy.sh

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x server-deploy.sh

# æ‰§è¡Œéƒ¨ç½²
bash server-deploy.sh
```

#### æ­¥éª¤ 3ï¼šæŒ‰ç…§æç¤ºæ“ä½œ

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰éƒ¨ç½²æ­¥éª¤ï¼Œæ‚¨åªéœ€è¦ï¼š
1. é¦–æ¬¡éƒ¨ç½²æ—¶ï¼Œå°†æ˜¾ç¤ºçš„ SSH å…¬é’¥æ·»åŠ åˆ° GitHub
2. å¦‚æœéœ€è¦é…ç½® SSLï¼Œè¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€
3. ç­‰å¾…éƒ¨ç½²å®Œæˆ

---

### æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨å¤åˆ¶è„šæœ¬åˆ°æœåŠ¡å™¨

å¦‚æœæ— æ³•ç›´æ¥ä¸‹è½½è„šæœ¬ï¼š

#### æ­¥éª¤ 1ï¼šè¿æ¥åˆ°æœåŠ¡å™¨

```powershell
ssh root@47.97.21.33
```

#### æ­¥éª¤ 2ï¼šåˆ›å»ºéƒ¨ç½²è„šæœ¬

```bash
# åˆ›å»ºè„šæœ¬æ–‡ä»¶
nano server-deploy.sh
```

#### æ­¥éª¤ 3ï¼šå¤åˆ¶è„šæœ¬å†…å®¹

ä»é¡¹ç›®ä¸­çš„ `deploy/server-deploy.sh` æ–‡ä»¶å¤åˆ¶æ‰€æœ‰å†…å®¹ï¼Œç²˜è´´åˆ°ç¼–è¾‘å™¨ä¸­ã€‚

ä¿å­˜ï¼š`Ctrl+X`, `Y`, `Enter`

#### æ­¥éª¤ 4ï¼šæ‰§è¡Œéƒ¨ç½²

```bash
chmod +x server-deploy.sh
bash server-deploy.sh
```

---

## ğŸ“‹ éƒ¨ç½²è„šæœ¬åŠŸèƒ½

è‡ªåŠ¨éƒ¨ç½²è„šæœ¬ä¼šå®Œæˆï¼š

1. âœ… **ç¯å¢ƒæ£€æŸ¥** - æ£€æŸ¥ Dockerã€Gitã€Nginx
2. âœ… **SSH é…ç½®** - é…ç½® GitHub SSH å¯†é’¥
3. âœ… **ä»£ç è·å–** - å…‹éš†æˆ–æ›´æ–°ä»£ç 
4. âœ… **ç¯å¢ƒé…ç½®** - é…ç½®ç¯å¢ƒå˜é‡
5. âœ… **Docker éƒ¨ç½²** - æ„å»ºå¹¶å¯åŠ¨å®¹å™¨
6. âœ… **Nginx é…ç½®** - é…ç½®åå‘ä»£ç†
7. âœ… **SSL é…ç½®** - é…ç½® HTTPS è¯ä¹¦
8. âœ… **éªŒè¯éƒ¨ç½²** - æµ‹è¯•æœåŠ¡çŠ¶æ€

---

## âš ï¸ é¦–æ¬¡éƒ¨ç½²æ³¨æ„äº‹é¡¹

### 1. GitHub SSH å¯†é’¥

é¦–æ¬¡è¿è¡Œæ—¶ï¼Œè„šæœ¬ä¼šæ˜¾ç¤ºï¼š

```
==========================================
é‡è¦: è¯·å°†ä»¥ä¸‹å…¬é’¥æ·»åŠ åˆ° GitHub
è®¿é—®: https://github.com/settings/keys
==========================================
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAA... deploy@manqiyou.cn
==========================================

æ·»åŠ å®ŒæˆåæŒ‰ Enter ç»§ç»­...
```

**æ“ä½œ**ï¼š
1. å¤åˆ¶æ˜¾ç¤ºçš„å…¬é’¥
2. è®¿é—® https://github.com/settings/keys
3. ç‚¹å‡» "New SSH key"
4. ç²˜è´´å…¬é’¥å¹¶ä¿å­˜
5. è¿”å›ç»ˆç«¯æŒ‰ Enter

### 2. SSL è¯ä¹¦é…ç½®

å¦‚æœæ˜¯é¦–æ¬¡é…ç½® SSLï¼Œè„šæœ¬ä¼šè¯¢é—®ï¼š

```
è¾“å…¥æ‚¨çš„é‚®ç®±åœ°å€: 
```

è¾“å…¥æ‚¨çš„çœŸå®é‚®ç®±åœ°å€ï¼Œç”¨äºæ¥æ”¶è¯ä¹¦åˆ°æœŸæé†’ã€‚

---

## ğŸ” éƒ¨ç½²è¿›åº¦è¯´æ˜

### é¢„è®¡æ—¶é—´ï¼š15-20 åˆ†é’Ÿ

| æ­¥éª¤ | è¯´æ˜ | æ—¶é—´ |
|------|------|------|
| [1/8] | æ£€æŸ¥ç¯å¢ƒ | 10ç§’ |
| [2/8] | é…ç½® SSH å¯†é’¥ | 30ç§’ |
| [3/8] | åˆ›å»ºé¡¹ç›®ç›®å½• | 10ç§’ |
| [4/8] | å…‹éš†ä»£ç  | 1-2åˆ†é’Ÿ |
| [5/8] | é…ç½®ç¯å¢ƒå˜é‡ | 10ç§’ |
| [6/8] | æ„å»º Docker å®¹å™¨ | **10-15åˆ†é’Ÿ** â° |
| [7/8] | é…ç½® Nginx | 30ç§’ |
| [8/8] | é…ç½® SSL | 1-2åˆ†é’Ÿ |

**æœ€è€—æ—¶çš„æ˜¯æ­¥éª¤ 6**ï¼Œéœ€è¦ä¸‹è½½ä¾èµ–å’Œæ„å»ºé•œåƒã€‚

---

## âœ… éƒ¨ç½²æˆåŠŸæ ‡å¿—

çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºè¡¨ç¤ºéƒ¨ç½²æˆåŠŸï¼š

```
==========================================
éƒ¨ç½²å®Œæˆï¼
==========================================

è®¿é—®åœ°å€: https://www.manqiyou.cn

å¸¸ç”¨å‘½ä»¤:
  æŸ¥çœ‹æ—¥å¿—: cd /var/www/manqiyou && docker-compose -f docker-compose.prod.yml logs -f
  é‡å¯æœåŠ¡: cd /var/www/manqiyou && docker-compose -f docker-compose.prod.yml restart
  åœæ­¢æœåŠ¡: cd /var/www/manqiyou && docker-compose -f docker-compose.prod.yml down
```

---

## ğŸ”§ éƒ¨ç½²åéªŒè¯

### 1. åœ¨æµè§ˆå™¨ä¸­è®¿é—®

```
https://www.manqiyou.cn
```

æ£€æŸ¥ï¼š
- âœ… é¡µé¢æ­£å¸¸åŠ è½½
- âœ… æµè§ˆå™¨æ˜¾ç¤ºå®‰å…¨é”å›¾æ ‡
- âœ… å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- âœ… ä¸­è‹±æ–‡åˆ‡æ¢æ­£å¸¸

### 2. æµ‹è¯•æ‰€æœ‰é¡µé¢

- https://www.manqiyou.cn/about
- https://www.manqiyou.cn/routes
- https://www.manqiyou.cn/ebike
- https://www.manqiyou.cn/community
- https://www.manqiyou.cn/partners
- https://www.manqiyou.cn/goods

### 3. åœ¨æœåŠ¡å™¨ä¸Šæ£€æŸ¥

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
cd /var/www/manqiyou
docker-compose -f docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f

# æµ‹è¯•åç«¯ API
curl http://localhost:8080/api/health
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

ä»£ç æ›´æ–°åï¼Œé‡æ–°éƒ¨ç½²ï¼š

### æ–¹æ³• 1ï¼šåœ¨æœ¬åœ°æ¨é€åè‡ªåŠ¨éƒ¨ç½²

```powershell
# 1. æ¨é€æ–°ä»£ç 
cd D:\mrcweb1
git add .
git commit -m "æ›´æ–°è¯´æ˜"
git push origin main

# 2. é‡æ–°è¿è¡Œéƒ¨ç½²è„šæœ¬
.\deploy-to-server.bat
```

### æ–¹æ³• 2ï¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨æ›´æ–°

```bash
# è¿æ¥æœåŠ¡å™¨
ssh root@47.97.21.33

# æ›´æ–°ä»£ç 
cd /var/www/manqiyou
git pull origin main

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose -f docker-compose.prod.yml up -d --build
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: SSH è¿æ¥å¤±è´¥

```powershell
# æµ‹è¯•è¿æ¥
ssh root@47.97.21.33

# å¦‚æœå¤±è´¥ï¼Œæ£€æŸ¥ï¼š
# 1. æœåŠ¡å™¨ IP æ˜¯å¦æ­£ç¡®
# 2. æœåŠ¡å™¨æ˜¯å¦åœ¨çº¿
# 3. é˜²ç«å¢™è®¾ç½®
```

### Q2: GitHub å…‹éš†å¤±è´¥

```bash
# æµ‹è¯• GitHub è¿æ¥
ssh -T git@github.com

# å¦‚æœå¤±è´¥ï¼Œé‡æ–°é…ç½® SSH å¯†é’¥
ssh-keygen -t ed25519 -C "deploy@manqiyou.cn"
cat ~/.ssh/id_ed25519.pub
# æ·»åŠ åˆ° GitHub
```

### Q3: Docker æ„å»ºå¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs

# é‡å¯ Docker
sudo systemctl restart docker

# é‡æ–°æ„å»º
docker-compose -f docker-compose.prod.yml up -d --build
```

### Q4: ç½‘ç«™æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose -f docker-compose.prod.yml ps

# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/manqiyou_error.log

# æµ‹è¯•æœ¬åœ°è®¿é—®
curl http://localhost:3000
curl http://localhost:8080/api/health
```

### Q5: SSL è¯ä¹¦é—®é¢˜

```bash
# æŸ¥çœ‹è¯ä¹¦çŠ¶æ€
sudo certbot certificates

# é‡æ–°è·å–è¯ä¹¦
sudo certbot delete --cert-name www.manqiyou.cn
sudo bash /var/www/manqiyou/deploy/setup-ssl.sh
```

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹æ—¥å¿—

```bash
# Docker æ—¥å¿—
cd /var/www/manqiyou
docker-compose -f docker-compose.prod.yml logs -f

# å‰ç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f frontend

# åç«¯æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f backend

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/manqiyou_access.log
sudo tail -f /var/log/nginx/manqiyou_error.log
```

### é‡å¯æœåŠ¡

```bash
cd /var/www/manqiyou

# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose -f docker-compose.prod.yml restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f docker-compose.prod.yml restart frontend
docker-compose -f docker-compose.prod.yml restart backend
```

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹ï¼ˆæ¨èæµç¨‹ï¼‰

```powershell
# === åœ¨æœ¬åœ° Windows ä¸Š ===

# 1. ç¡®ä¿ä»£ç å·²æ¨é€
cd D:\mrcweb1
git push origin main

# 2. è¿è¡Œè‡ªåŠ¨éƒ¨ç½²
.\deploy-to-server.bat

# === æˆ–è€…ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Š ===

# 1. è¿æ¥æœåŠ¡å™¨
ssh root@47.97.21.33

# 2. æ‰§è¡Œéƒ¨ç½²è„šæœ¬
bash <(curl -s https://raw.githubusercontent.com/zhf186/mqyweb/main/deploy/server-deploy.sh)

# === ç­‰å¾…å®Œæˆ ===
# 15-20 åˆ†é’Ÿåè®¿é—®: https://www.manqiyou.cn
```

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-01-29  
**é¢„è®¡éƒ¨ç½²æ—¶é—´**: 15-20 åˆ†é’Ÿ  
**éš¾åº¦**: â­â­â˜†â˜†â˜† (ç®€å•)
