# æ¼«éª‘æ¸¸é¡¹ç›® - é˜¿é‡Œäº‘éƒ¨ç½²æ–¹æ¡ˆæ€»ç»“

## ğŸ“¦ å·²åˆ›å»ºçš„éƒ¨ç½²æ–‡ä»¶

### æ–‡æ¡£æ–‡ä»¶
1. **DEPLOYMENT.md** - å®Œæ•´éƒ¨ç½²æ–‡æ¡£ï¼ˆæ ¹ç›®å½•ï¼‰
   - è¯¦ç»†çš„åˆ†æ­¥éƒ¨ç½²æŒ‡å—
   - åŒ…å«æ‰€æœ‰é…ç½®è¯´æ˜
   - æ•…éšœæ’æŸ¥æŒ‡å—

2. **deploy/QUICK-START.md** - 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²æŒ‡å—
   - ä¸‰ç§éƒ¨ç½²æ–¹å¼
   - å¿«é€Ÿä¸Šæ‰‹æµç¨‹
   - å¸¸è§é—®é¢˜è§£ç­”

3. **deploy/README.md** - éƒ¨ç½²è„šæœ¬ä½¿ç”¨è¯´æ˜
   - æ‰€æœ‰è„šæœ¬çš„è¯¦ç»†è¯´æ˜
   - ä½¿ç”¨æ–¹æ³•å’Œå‚æ•°
   - æ•…éšœæ’æŸ¥

4. **deploy/CHECKLIST.md** - éƒ¨ç½²æ£€æŸ¥æ¸…å•
   - éƒ¨ç½²å‰å‡†å¤‡
   - åˆ†æ­¥éª¤æ£€æŸ¥é¡¹
   - éƒ¨ç½²åéªŒè¯

### è‡ªåŠ¨åŒ–è„šæœ¬

1. **deploy/setup-server.sh** - æœåŠ¡å™¨ç¯å¢ƒé…ç½®
   - å®‰è£… Node.js 20.x
   - å®‰è£… Java 17
   - å®‰è£… PM2ã€Nginxã€Certbot
   - é…ç½®é˜²ç«å¢™

2. **deploy/deploy.sh** - è‡ªåŠ¨éƒ¨ç½²è„šæœ¬
   - æ„å»ºå‰åç«¯
   - é…ç½®è¿›ç¨‹ç®¡ç†
   - é…ç½® Nginx åå‘ä»£ç†

3. **deploy/update.sh** - å¿«é€Ÿæ›´æ–°è„šæœ¬
   - æ‹‰å–æœ€æ–°ä»£ç 
   - é‡æ–°æ„å»º
   - é‡å¯æœåŠ¡

4. **deploy/ssl-setup.sh** - SSL è¯ä¹¦é…ç½®
   - è‡ªåŠ¨è·å– Let's Encrypt è¯ä¹¦
   - é…ç½® HTTPS
   - è®¾ç½®è‡ªåŠ¨ç»­æœŸ

5. **deploy/upload-to-server.ps1** - Windows ä¸Šä¼ è„šæœ¬
   - ä»æœ¬åœ°ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨
   - æ”¯æŒ rsync æˆ– SCP

---

## ğŸš€ æ¨èéƒ¨ç½²æµç¨‹

### æ–¹å¼ä¸€ï¼šå…¨è‡ªåŠ¨éƒ¨ç½²ï¼ˆæœ€ç®€å•ï¼‰

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh username@your-server-ip

# 2. ä¸‹è½½é¡¹ç›®ä»£ç 
git clone <ä½ çš„ä»“åº“åœ°å€> /var/www/manqiyou
cd /var/www/manqiyou

# 3. è¿è¡Œç¯å¢ƒé…ç½®ï¼ˆé¦–æ¬¡ï¼‰
bash deploy/setup-server.sh

# 4. è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy/deploy.sh
# è¾“å…¥åŸŸå: manqiyou.com

# 5. é…ç½® SSL
bash deploy/ssl-setup.sh
# è¾“å…¥åŸŸåå’Œé‚®ç®±

# å®Œæˆï¼è®¿é—® https://your-domain.com
```

**æ—¶é—´ï¼šçº¦ 10-15 åˆ†é’Ÿ**

### æ–¹å¼äºŒï¼šä»æœ¬åœ°ä¸Šä¼ éƒ¨ç½²

```powershell
# 1. åœ¨æœ¬åœ° Windows PowerShell ä¸­ä¸Šä¼ ä»£ç 
cd D:\mrcweb1
.\deploy\upload-to-server.ps1 -ServerIP "1.2.3.4" -Username "ubuntu"

# 2. SSH ç™»å½•æœåŠ¡å™¨
ssh ubuntu@1.2.3.4
cd /var/www/manqiyou

# 3. è¿è¡Œéƒ¨ç½²è„šæœ¬
bash deploy/setup-server.sh
bash deploy/deploy.sh
bash deploy/ssl-setup.sh
```

**æ—¶é—´ï¼šçº¦ 15-20 åˆ†é’Ÿ**

---

## ğŸ“‹ éƒ¨ç½²æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¿é‡Œäº‘æœåŠ¡å™¨                          â”‚
â”‚                  Ubuntu 24.04                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Nginx      â”‚         â”‚   Certbot    â”‚            â”‚
â”‚  â”‚   (80/443)   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚   (SSL)      â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                                              â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚             â”‚              â”‚                â”‚
â”‚         â–¼             â–¼              â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  é™æ€èµ„æº â”‚  â”‚  å‰ç«¯     â”‚  â”‚  åç«¯     â”‚           â”‚
â”‚  â”‚  /brand_ â”‚  â”‚  Next.js  â”‚  â”‚  Spring  â”‚           â”‚
â”‚  â”‚  assets  â”‚  â”‚  :3000    â”‚  â”‚  Boot    â”‚           â”‚
â”‚  â”‚          â”‚  â”‚  (PM2)    â”‚  â”‚  :8080   â”‚           â”‚
â”‚  â”‚          â”‚  â”‚           â”‚  â”‚(systemd) â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                    â”‚                   â”‚
â”‚                                    â–¼                   â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚                              â”‚    H2    â”‚             â”‚
â”‚                              â”‚ Database â”‚             â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç«¯å£è¯´æ˜
- **80** - HTTPï¼ˆè‡ªåŠ¨è·³è½¬åˆ° HTTPSï¼‰
- **443** - HTTPSï¼ˆå¯¹å¤–è®¿é—®ï¼‰
- **3000** - Next.js å‰ç«¯ï¼ˆå†…éƒ¨ï¼‰
- **8080** - Spring Boot åç«¯ï¼ˆå†…éƒ¨ï¼‰

### è¿›ç¨‹ç®¡ç†
- **å‰ç«¯**: PM2 ç®¡ç†ï¼Œè‡ªåŠ¨é‡å¯
- **åç«¯**: systemd ç®¡ç†ï¼Œå¼€æœºè‡ªå¯
- **Nginx**: systemd ç®¡ç†ï¼Œåå‘ä»£ç†

---

## ğŸ”§ å…³é”®é…ç½®æ–‡ä»¶

### 1. Nginx é…ç½®
**ä½ç½®**: `/etc/nginx/sites-available/manqiyou`

**åŠŸèƒ½**:
- åå‘ä»£ç†å‰ç«¯ï¼ˆç«¯å£ 3000ï¼‰
- åå‘ä»£ç†åç«¯ APIï¼ˆç«¯å£ 8080ï¼‰
- SSL/TLS é…ç½®
- é™æ€èµ„æºç¼“å­˜
- Gzip å‹ç¼©

### 2. PM2 é…ç½®
**ä½ç½®**: `/var/www/manqiyou/frontend/ecosystem.config.js`

**åŠŸèƒ½**:
- ç®¡ç† Next.js è¿›ç¨‹
- è‡ªåŠ¨é‡å¯
- å†…å­˜é™åˆ¶

### 3. systemd æœåŠ¡
**ä½ç½®**: `/etc/systemd/system/manqiyou-backend.service`

**åŠŸèƒ½**:
- ç®¡ç† Spring Boot è¿›ç¨‹
- å¼€æœºè‡ªå¯
- å¤±è´¥è‡ªåŠ¨é‡å¯

### 4. ç¯å¢ƒå˜é‡
**å‰ç«¯**: `/var/www/manqiyou/frontend/.env.production`
```env
NEXT_PUBLIC_API_URL=https://your-domain.com/api
```

**åç«¯**: `/var/www/manqiyou/backend/.env`ï¼ˆå¯é€‰ï¼Œä½¿ç”¨ PostgreSQL æ—¶ï¼‰
```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=manqiyou
DB_USERNAME=manqiyou_user
DB_PASSWORD=your_password
```

---

## ğŸ“Š æ—¥å¸¸è¿ç»´å‘½ä»¤

### æŸ¥çœ‹çŠ¶æ€
```bash
# å‰ç«¯
pm2 status
pm2 logs manqiyou-frontend

# åç«¯
sudo systemctl status manqiyou-backend
sudo journalctl -u manqiyou-backend -f

# Nginx
sudo systemctl status nginx
sudo tail -f /var/log/nginx/manqiyou_access.log
```

### é‡å¯æœåŠ¡
```bash
# å‰ç«¯
pm2 restart manqiyou-frontend

# åç«¯
sudo systemctl restart manqiyou-backend

# Nginx
sudo systemctl reload nginx
```

### æ›´æ–°ä»£ç 
```bash
cd /var/www/manqiyou
bash deploy/update.sh
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. æœåŠ¡å™¨å®‰å…¨
- âœ… ä½¿ç”¨ SSH å¯†é’¥ç™»å½•ï¼Œç¦ç”¨å¯†ç ç™»å½•
- âœ… é…ç½®é˜²ç«å¢™ï¼ˆUFWï¼‰
- âœ… å®‰è£… fail2ban é˜²æ­¢æš´åŠ›ç ´è§£
- âœ… å®šæœŸæ›´æ–°ç³»ç»Ÿ

### 2. åº”ç”¨å®‰å…¨
- âœ… ä½¿ç”¨ HTTPSï¼ˆLet's Encryptï¼‰
- âœ… é…ç½®å®‰å…¨å¤´ï¼ˆX-Frame-Options, CSP ç­‰ï¼‰
- âœ… é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°
- âœ… å®šæœŸå¤‡ä»½æ•°æ®

### 3. æ•°æ®åº“å®‰å…¨ï¼ˆå¦‚ä½¿ç”¨ PostgreSQLï¼‰
- âœ… ä½¿ç”¨å¼ºå¯†ç 
- âœ… é™åˆ¶è¿œç¨‹è®¿é—®
- âœ… å®šæœŸå¤‡ä»½
- âœ… åŠ å¯†æ•æ„Ÿæ•°æ®

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. Nginx ä¼˜åŒ–
- å¯ç”¨ Gzip å‹ç¼©
- é…ç½®é™æ€èµ„æºç¼“å­˜
- å¯ç”¨ HTTP/2
- é…ç½®è¿æ¥æ± 

### 2. å‰ç«¯ä¼˜åŒ–
- ä½¿ç”¨ Next.js ç”Ÿäº§æ„å»º
- å¯ç”¨å›¾ç‰‡ä¼˜åŒ–
- é…ç½® CDNï¼ˆå¯é€‰ï¼‰
- å¢åŠ  PM2 å®ä¾‹æ•°

### 3. åç«¯ä¼˜åŒ–
- é…ç½® JVM å‚æ•°
- å¯ç”¨æ•°æ®åº“è¿æ¥æ± 
- é…ç½® Redis ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
- ä½¿ç”¨ PostgreSQL æ›¿ä»£ H2

---

## ğŸ› å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨
```bash
sudo netstat -tulpn | grep -E ':(80|443|3000|8080)'
sudo kill -9 <PID>
```

### 2. æ„å»ºå¤±è´¥
```bash
# å‰ç«¯
cd /var/www/manqiyou/frontend
rm -rf node_modules .next
npm install
npm run build

# åç«¯
cd /var/www/manqiyou/backend/manqiyou-app
./mvnw clean package -DskipTests
```

### 3. SSL è¯ä¹¦è·å–å¤±è´¥
- ç¡®è®¤åŸŸåå·²è§£æ
- ç¡®è®¤é˜²ç«å¢™å¼€æ”¾ 80 ç«¯å£
- ç¡®è®¤ Nginx æ­£åœ¨è¿è¡Œ

### 4. æœåŠ¡æ— æ³•å¯åŠ¨
- æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- æ£€æŸ¥é…ç½®æ–‡ä»¶
- éªŒè¯ä¾èµ–å®‰è£…

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£èµ„æº
1. **DEPLOYMENT.md** - å®Œæ•´éƒ¨ç½²æ–‡æ¡£
2. **QUICK-START.md** - å¿«é€Ÿå¼€å§‹æŒ‡å—
3. **CHECKLIST.md** - éƒ¨ç½²æ£€æŸ¥æ¸…å•
4. **README.md** - è„šæœ¬ä½¿ç”¨è¯´æ˜

### æ—¥å¿—ä½ç½®
- å‰ç«¯: `pm2 logs manqiyou-frontend`
- åç«¯: `sudo journalctl -u manqiyou-backend`
- Nginx: `/var/log/nginx/manqiyou_*.log`

### é…ç½®æ–‡ä»¶ä½ç½®
- Nginx: `/etc/nginx/sites-available/manqiyou`
- PM2: `/var/www/manqiyou/frontend/ecosystem.config.js`
- systemd: `/etc/systemd/system/manqiyou-backend.service`

---

## âœ… éƒ¨ç½²å®Œæˆæ£€æŸ¥

éƒ¨ç½²å®Œæˆåï¼Œç¡®è®¤ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] ç½‘ç«™å¯ä»¥é€šè¿‡ HTTPS è®¿é—®
- [ ] HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS
- [ ] é¦–é¡µåŠ è½½æ­£å¸¸
- [ ] éª‘è¡Œçº¿è·¯é¡µé¢æ­£å¸¸
- [ ] API æ¥å£æ­£å¸¸å“åº”
- [ ] å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- [ ] SSL è¯ä¹¦æœ‰æ•ˆ
- [ ] æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] æ—¥å¿—æ— é”™è¯¯

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬éƒ¨ç½²æ–¹æ¡ˆï¼Œä½ å¯ä»¥ï¼š

1. **å¿«é€Ÿéƒ¨ç½²** - ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œ10-15 åˆ†é’Ÿå®Œæˆéƒ¨ç½²
2. **å®‰å…¨å¯é ** - HTTPSã€é˜²ç«å¢™ã€è¿›ç¨‹ç®¡ç†
3. **æ˜“äºç»´æŠ¤** - ä¸€é”®æ›´æ–°ã€æ—¥å¿—ç›‘æ§ã€è‡ªåŠ¨é‡å¯
4. **æ€§èƒ½ä¼˜åŒ–** - Nginx åå‘ä»£ç†ã€é™æ€èµ„æºç¼“å­˜
5. **æ–‡æ¡£å®Œå–„** - è¯¦ç»†çš„æ–‡æ¡£å’Œæ£€æŸ¥æ¸…å•

**ç¥éƒ¨ç½²é¡ºåˆ©ï¼** ğŸš€

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£æˆ–æŸ¥çœ‹æ—¥å¿—æ’æŸ¥ã€‚
