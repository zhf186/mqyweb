# éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### æœåŠ¡å™¨å‡†å¤‡
- [ ] é˜¿é‡Œäº‘æœåŠ¡å™¨å·²åˆ›å»ºï¼ˆUbuntu 24.04ï¼‰
- [ ] æœåŠ¡å™¨å¯ä»¥é€šè¿‡ SSH è®¿é—®
- [ ] æœåŠ¡å™¨æœ‰è¶³å¤Ÿçš„èµ„æºï¼ˆå»ºè®®ï¼š2æ ¸4Gä»¥ä¸Šï¼‰
- [ ] å®‰å…¨ç»„å·²å¼€æ”¾ç«¯å£ï¼š22 (SSH), 80 (HTTP), 443 (HTTPS)

### åŸŸåå‡†å¤‡
- [ ] åŸŸåå·²è´­ä¹°
- [ ] åŸŸåå·²å¤‡æ¡ˆï¼ˆä¸­å›½å¤§é™†æœåŠ¡å™¨å¿…éœ€ï¼‰
- [ ] DNS å·²è§£æåˆ°æœåŠ¡å™¨ IP
  - [ ] A è®°å½•ï¼šyour-domain.com â†’ æœåŠ¡å™¨IP
  - [ ] A è®°å½•ï¼šwww.your-domain.com â†’ æœåŠ¡å™¨IP
- [ ] DNS è§£æå·²ç”Ÿæ•ˆï¼ˆå¯ç”¨ `nslookup your-domain.com` éªŒè¯ï¼‰

### æœ¬åœ°å‡†å¤‡
- [ ] é¡¹ç›®ä»£ç å·²æäº¤åˆ° Git ä»“åº“
- [ ] æˆ–å‡†å¤‡å¥½é€šè¿‡ SCP/rsync ä¸Šä¼ ä»£ç 
- [ ] SSH å¯†é’¥å·²é…ç½®ï¼ˆæ¨èï¼‰æˆ–çŸ¥é“æœåŠ¡å™¨å¯†ç 

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤æ£€æŸ¥

### ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒé…ç½®

- [ ] SSH ç™»å½•æœåŠ¡å™¨æˆåŠŸ
  ```bash
  ssh username@your-server-ip
  ```

- [ ] ä¸Šä¼ é¡¹ç›®ä»£ç åˆ°æœåŠ¡å™¨
  ```bash
  # æ–¹å¼1: Git clone
  git clone <repo-url> /var/www/manqiyou
  
  # æ–¹å¼2: ä»æœ¬åœ°ä¸Šä¼ 
  # Windows: .\deploy\upload-to-server.ps1 -ServerIP "x.x.x.x" -Username "ubuntu"
  # Linux: rsync -avz ./ username@server:/var/www/manqiyou/
  ```

- [ ] è¿è¡Œç¯å¢ƒé…ç½®è„šæœ¬
  ```bash
  cd /var/www/manqiyou
  bash deploy/setup-server.sh
  ```

- [ ] éªŒè¯ç¯å¢ƒå®‰è£…
  ```bash
  node --version    # åº”æ˜¾ç¤º v20.x.x
  java -version     # åº”æ˜¾ç¤º 17.x.x
  pm2 --version     # åº”æ˜¾ç¤ºç‰ˆæœ¬å·
  nginx -v          # åº”æ˜¾ç¤ºç‰ˆæœ¬å·
  certbot --version # åº”æ˜¾ç¤ºç‰ˆæœ¬å·
  ```

### ç¬¬äºŒé˜¶æ®µï¼šé¡¹ç›®éƒ¨ç½²

- [ ] ç¡®è®¤é¡¹ç›®ç›®å½•ç»“æ„æ­£ç¡®
  ```bash
  ls -la /var/www/manqiyou
  # åº”è¯¥çœ‹åˆ°: frontend/, backend/, deploy/, README.md ç­‰
  ```

- [ ] è¿è¡Œéƒ¨ç½²è„šæœ¬
  ```bash
  cd /var/www/manqiyou
  bash deploy/deploy.sh
  ```

- [ ] è¾“å…¥åŸŸåï¼ˆä¾‹å¦‚ï¼šmanqiyou.comï¼‰

- [ ] ç­‰å¾…æ„å»ºå®Œæˆï¼ˆå¯èƒ½éœ€è¦ 5-10 åˆ†é’Ÿï¼‰

- [ ] éªŒè¯æœåŠ¡å¯åŠ¨
  ```bash
  # å‰ç«¯
  pm2 status
  # åº”è¯¥çœ‹åˆ° manqiyou-frontend çŠ¶æ€ä¸º online
  
  # åç«¯
  sudo systemctl status manqiyou-backend
  # åº”è¯¥çœ‹åˆ° active (running)
  
  # Nginx
  sudo systemctl status nginx
  # åº”è¯¥çœ‹åˆ° active (running)
  ```

### ç¬¬ä¸‰é˜¶æ®µï¼šSSL é…ç½®

- [ ] ç¡®è®¤åŸŸåå·²è§£æï¼ˆé‡è¦ï¼ï¼‰
  ```bash
  nslookup your-domain.com
  ping your-domain.com
  ```

- [ ] è¿è¡Œ SSL é…ç½®è„šæœ¬
  ```bash
  bash deploy/ssl-setup.sh
  ```

- [ ] è¾“å…¥åŸŸåå’Œé‚®ç®±

- [ ] ç­‰å¾…è¯ä¹¦è·å–å®Œæˆ

- [ ] éªŒè¯ HTTPS è®¿é—®
  ```bash
  curl -I https://your-domain.com
  # åº”è¯¥è¿”å› 200 OK
  ```

---

## âœ… éƒ¨ç½²åéªŒè¯

### åŠŸèƒ½æµ‹è¯•

- [ ] è®¿é—®ç½‘ç«™é¦–é¡µ
  - [ ] HTTP: http://your-domain.com ï¼ˆåº”è‡ªåŠ¨è·³è½¬åˆ° HTTPSï¼‰
  - [ ] HTTPS: https://your-domain.com

- [ ] æµ‹è¯•å‰ç«¯é¡µé¢
  - [ ] é¦–é¡µåŠ è½½æ­£å¸¸
  - [ ] å›¾ç‰‡æ˜¾ç¤ºæ­£å¸¸
  - [ ] å¯¼èˆªèœå•å·¥ä½œæ­£å¸¸
  - [ ] éª‘è¡Œçº¿è·¯é¡µé¢ (/routes) æ­£å¸¸

- [ ] æµ‹è¯•åç«¯ API
  ```bash
  # å¥åº·æ£€æŸ¥
  curl https://your-domain.com/api/health
  
  # è·å–çº¿è·¯åˆ—è¡¨
  curl https://your-domain.com/api/routes
  
  # è·å–åˆ†ç±»
  curl https://your-domain.com/api/categories
  ```

- [ ] æµ‹è¯•å“åº”é€Ÿåº¦
  - [ ] é¦–é¡µåŠ è½½æ—¶é—´ < 3ç§’
  - [ ] API å“åº”æ—¶é—´ < 1ç§’

### å®‰å…¨æ£€æŸ¥

- [ ] HTTPS è¯ä¹¦æœ‰æ•ˆ
  - æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºé”å›¾æ ‡
  - è¯ä¹¦ä¿¡æ¯æ­£ç¡®

- [ ] HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS

- [ ] é˜²ç«å¢™è§„åˆ™æ­£ç¡®
  ```bash
  sudo ufw status
  # åº”è¯¥çœ‹åˆ°: 22/tcp, 80/tcp, 443/tcp ALLOW
  ```

- [ ] æ•æ„Ÿç«¯å£æœªæš´éœ²
  ```bash
  sudo netstat -tulpn | grep -E ':(3000|8080)'
  # åº”è¯¥åªç›‘å¬ 127.0.0.1ï¼Œä¸æ˜¯ 0.0.0.0
  ```

### æ€§èƒ½æ£€æŸ¥

- [ ] æœåŠ¡å™¨èµ„æºä½¿ç”¨æ­£å¸¸
  ```bash
  htop
  # CPU < 50%, å†…å­˜ < 80%
  ```

- [ ] æ—¥å¿—æ— é”™è¯¯
  ```bash
  # å‰ç«¯æ—¥å¿—
  pm2 logs manqiyou-frontend --lines 50
  
  # åç«¯æ—¥å¿—
  sudo journalctl -u manqiyou-backend -n 50
  
  # Nginx æ—¥å¿—
  sudo tail -50 /var/log/nginx/manqiyou_error.log
  ```

---

## ğŸ“Š ç›‘æ§è®¾ç½®

### æ—¥å¿—ç›‘æ§

- [ ] é…ç½®æ—¥å¿—è½®è½¬
  ```bash
  # æ£€æŸ¥æ˜¯å¦å·²é…ç½®
  ls -la /etc/logrotate.d/
  ```

- [ ] è®¾ç½®æ—¥å¿—å‘Šè­¦ï¼ˆå¯é€‰ï¼‰

### æœåŠ¡ç›‘æ§

- [ ] PM2 å¼€æœºè‡ªå¯å·²é…ç½®
  ```bash
  pm2 startup
  pm2 save
  ```

- [ ] systemd æœåŠ¡å·²å¯ç”¨
  ```bash
  sudo systemctl is-enabled manqiyou-backend
  # åº”è¯¥æ˜¾ç¤º enabled
  ```

- [ ] SSL è¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²é…ç½®
  ```bash
  sudo systemctl status certbot.timer
  # åº”è¯¥æ˜¾ç¤º active
  ```

### å¤‡ä»½è®¾ç½®

- [ ] é…ç½®æ•°æ®åº“å¤‡ä»½ï¼ˆå¦‚ä½¿ç”¨ PostgreSQLï¼‰
- [ ] é…ç½®ä»£ç å¤‡ä»½
- [ ] æµ‹è¯•æ¢å¤æµç¨‹

---

## ğŸ”„ åç»­ç»´æŠ¤

### æ—¥å¸¸æ£€æŸ¥ï¼ˆæ¯å¤©ï¼‰

- [ ] æ£€æŸ¥æœåŠ¡çŠ¶æ€
  ```bash
  pm2 status
  sudo systemctl status manqiyou-backend
  ```

- [ ] æŸ¥çœ‹è®¿é—®æ—¥å¿—
  ```bash
  sudo tail -f /var/log/nginx/manqiyou_access.log
  ```

### å®šæœŸæ£€æŸ¥ï¼ˆæ¯å‘¨ï¼‰

- [ ] æ£€æŸ¥æœåŠ¡å™¨èµ„æºä½¿ç”¨
- [ ] æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- [ ] æ£€æŸ¥ç£ç›˜ç©ºé—´
  ```bash
  df -h
  ```

### å®šæœŸç»´æŠ¤ï¼ˆæ¯æœˆï¼‰

- [ ] æ›´æ–°ç³»ç»Ÿ
  ```bash
  sudo apt update && sudo apt upgrade -y
  ```

- [ ] æ¸…ç†æ—¥å¿—æ–‡ä»¶
  ```bash
  sudo journalctl --vacuum-time=30d
  ```

- [ ] æ£€æŸ¥ SSL è¯ä¹¦æœ‰æ•ˆæœŸ
  ```bash
  sudo certbot certificates
  ```

- [ ] å¤‡ä»½æ•°æ®

---

## ğŸ› å¸¸è§é—®é¢˜å¿«é€Ÿæ£€æŸ¥

### ç½‘ç«™æ— æ³•è®¿é—®

- [ ] æ£€æŸ¥æœåŠ¡æ˜¯å¦è¿è¡Œ
- [ ] æ£€æŸ¥é˜²ç«å¢™è§„åˆ™
- [ ] æ£€æŸ¥åŸŸåè§£æ
- [ ] æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—

### API è¿”å› 502

- [ ] æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- [ ] æŸ¥çœ‹åç«¯æ—¥å¿—
- [ ] æ£€æŸ¥ç«¯å£ 8080 æ˜¯å¦ç›‘å¬

### å‰ç«¯é¡µé¢ç©ºç™½

- [ ] æ£€æŸ¥å‰ç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
- [ ] æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
- [ ] æ£€æŸ¥ PM2 æ—¥å¿—

### SSL è¯ä¹¦é”™è¯¯

- [ ] æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ
- [ ] æ£€æŸ¥åŸŸåæ˜¯å¦æ­£ç¡®
- [ ] é‡æ–°è·å–è¯ä¹¦

---

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. âœ… æ£€æŸ¥æœ¬æ¸…å•ä¸­çš„æ‰€æœ‰é¡¹ç›®
2. ğŸ“– æŸ¥çœ‹ [DEPLOYMENT.md](../DEPLOYMENT.md) è¯¦ç»†æ–‡æ¡£
3. ğŸ“ æŸ¥çœ‹æœåŠ¡æ—¥å¿—
4. ğŸ” æœç´¢é”™è¯¯ä¿¡æ¯
5. ğŸ’¬ è”ç³»æŠ€æœ¯æ”¯æŒ

---

**å®Œæˆæ‰€æœ‰æ£€æŸ¥é¡¹åï¼Œä½ çš„ç½‘ç«™å°±å¯ä»¥æ­£å¼ä¸Šçº¿äº†ï¼** ğŸ‰
